<!DOCTYPE html>
<html lang="en">
  <head>
    <title>  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
           Docs
        </a>
         (92% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/MrLotU/SwiftPrometheus">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fmrlotu%2Egithub%2Eio%2FSwiftPrometheus%2Fdocsets%2F%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html"> Reference</a>
      <img class="carat" src="img/carat.png" />
        Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PromCounter.html">PromCounter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PromGauge.html">PromGauge</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PromHistogram.html">PromHistogram</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PromSummary.html">PromSummary</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/PrometheusClient.html">PrometheusClient</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PromMetricType.html">PromMetricType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/Prometheus.html">Prometheus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/PrometheusError.html">PrometheusError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/FixedWidthInteger.html">FixedWidthInteger</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Float.html">Float</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:Si">Int</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s5Int16V">Int16</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s5Int32V">Int32</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s5Int64V">Int64</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s4Int8V">Int8</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/MetricsSystem.html">MetricsSystem</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:Su">UInt</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s6UInt16V">UInt16</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s6UInt32V">UInt32</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s6UInt64V">UInt64</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions.html#/s:s5UInt8V">UInt8</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ConvertibleNumberType.html">ConvertibleNumberType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/DoubleRepresentable.html">DoubleRepresentable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/HistogramLabels.html">HistogramLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/LabelSanitizer.html">LabelSanitizer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MetricLabels.html">MetricLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PromMetric.html">PromMetric</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/SummaryLabels.html">SummaryLabels</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Buckets.html">Buckets</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DimensionHistogramLabels.html">DimensionHistogramLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DimensionLabels.html">DimensionLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/DimensionSummaryLabels.html">DimensionSummaryLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/EmptyHistogramLabels.html">EmptyHistogramLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/EmptyLabels.html">EmptyLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/EmptySummaryLabels.html">EmptySummaryLabels</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PrometheusLabelSanitizer.html">PrometheusLabelSanitizer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PrometheusMetricsFactory.html">PrometheusMetricsFactory</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PrometheusMetricsFactory/TimerImplementation.html">– TimerImplementation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/PrometheusMetricsFactory/Configuration.html">– Configuration</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <p><a href="https://circleci.com/gh/MrLotU/SwiftPrometheus"><img src="https://circleci.com/gh/MrLotU/SwiftPrometheus.svg?style=svg" alt="CircleCI"></a><a href="http://swift.org"><img src="https://img.shields.io/badge/swift-5.0-orange.svg?style=flat" alt="Swift 5.0"></a></p>
<h1 id='swiftprometheus-prometheus-client-for-swift' class='heading'>SwiftPrometheus, Prometheus client for Swift</h1>

<p>A prometheus client for Swift supporting counters, gauges, histograms, summaries and info.</p>
<h1 id='installation' class='heading'>Installation</h1>

<p>SwiftPrometheus is available through SPM. To include it in your project add the following dependency to your <code>Package.swift</code>:</p>
<pre class="highlight swift"><code>        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/MrLotU/SwiftPrometheus.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.0.0-alpha"</span><span class="p">)</span>
</code></pre>

<p><em>NOTE: For NIO 1 use <code>from: &quot;0.4.0-alpha&quot;</code> instead.</em></p>
<h1 id='usage' class='heading'>Usage</h1>

<p>To see a working demo, see <a href="./Sources/PrometheusExample/main.swift">PrometheusExample</a>.</p>

<p>First, we have to create an instance of our <code><a href="Classes/PrometheusClient.html">PrometheusClient</a></code>:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">Prometheus</span>
<span class="k">let</span> <span class="nv">myProm</span> <span class="o">=</span> <span class="kt">PrometheusClient</span><span class="p">()</span>
</code></pre>
<h2 id='usage-with-swiftmetrics' class='heading'>Usage with SwiftMetrics</h2>

<p><em>For more details about swift-metrics, please view <a href="https://github.com/apple/swift-metrics">the GitHub repo</a>.</em></p>

<p>Starting with SwiftPrometheus <a href="https://github.com/MrLotU/SwiftPrometheus/releases/tag/1.0.0-alpha.10">1.0.0-alpha.10</a> <code>MetricsSystem</code> is no longer directly configured with a <code><a href="Classes/PrometheusClient.html">PrometheusClient</a></code>.</p>

<p>Instead, create a <code><a href="Structs/PrometheusMetricsFactory.html">PrometheusMetricsFactory</a></code> instance wrapping a <code><a href="Classes/PrometheusClient.html">PrometheusClient</a></code>.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">myProm</span> <span class="o">=</span> <span class="kt">PrometheusClient</span><span class="p">()</span>
<span class="kt">MetricsSystem</span><span class="o">.</span><span class="nf">bootstrap</span><span class="p">(</span><span class="kt">PrometheusMetricsFactory</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span> <span class="n">myProm</span><span class="p">))</span>
</code></pre>

<p>Along with a <code><a href="Classes/PrometheusClient.html">PrometheusClient</a></code>, <code><a href="Structs/PrometheusMetricsFactory.html">PrometheusMetricsFactory</a></code> can take a <code>Configuration</code> object setting the following properties:</p>

<ul>
<li>A <code><a href="Protocols/LabelSanitizer.html">LabelSanitizer</a></code> used to sanitize metric names to valid Prometheus values. A default implementation is provided.</li>
<li>The Prometheus metric type to use for swift-metrics&rsquo; <code>Timer</code>. Can be a <code>Histogram</code> or a <code>Summary</code>. Note that when using <code>Histogram</code>, <code>preferredDisplayUnit</code> will not be observed.</li>
<li>Default buckets for use by aggregating swift-metrics <code>Recorder</code> instances.</li>
</ul>
<h3 id='before-alpha-10' class='heading'>Before Alpha 10</h3>

<p>To use SwiftPrometheus with swift-metrics, you need to configure the backend inside the <code>MetricsSystem</code>:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">Metrics</span>
<span class="kd">import</span> <span class="kt">Prometheus</span>
<span class="k">let</span> <span class="nv">myProm</span> <span class="o">=</span> <span class="kt">PrometheusClient</span><span class="p">()</span>
<span class="kt">MetricsSystem</span><span class="o">.</span><span class="nf">bootstrap</span><span class="p">(</span><span class="n">myProm</span><span class="p">)</span>
</code></pre>

<p>To use prometheus-specific features in a later stage of your program, or to get your metrics out of the system, there is a convenience method added to <code>MetricsSystem</code>:</p>
<pre class="highlight swift"><code><span class="c1">// This returns the same instance passed in to `.bootstrap()` earlier.</span>
<span class="k">let</span> <span class="nv">promInstance</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">MetricsSystem</span><span class="o">.</span><span class="nf">prometheus</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">promInstance</span><span class="o">.</span><span class="nf">collect</span><span class="p">())</span>
</code></pre>

<p>You can then use the same APIs described in the rest of this README.</p>
<h2 id='counter' class='heading'>Counter</h2>

<p>Counters go up (they can only increase in value), and reset when the process restarts.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">counter</span> <span class="o">=</span> <span class="n">myProm</span><span class="o">.</span><span class="nf">createCounter</span><span class="p">(</span><span class="nv">forType</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">named</span><span class="p">:</span> <span class="s">"my_counter"</span><span class="p">)</span>
<span class="n">counter</span><span class="o">.</span><span class="nf">inc</span><span class="p">()</span> <span class="c1">// Increment by 1</span>
<span class="n">counter</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="c1">// Increment by given value</span>
</code></pre>
<h2 id='gauge' class='heading'>Gauge</h2>

<p>Gauges can go up and down, they represent a &ldquo;point-in-time&rdquo; snapshot of a value. This is similar to the speedometer of a car.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">gauge</span> <span class="o">=</span> <span class="n">myProm</span><span class="o">.</span><span class="nf">createGauge</span><span class="p">(</span><span class="nv">forType</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">named</span><span class="p">:</span> <span class="s">"my_gauge"</span><span class="p">)</span>
<span class="n">gauge</span><span class="o">.</span><span class="nf">inc</span><span class="p">()</span> <span class="c1">// Increment by 1</span>
<span class="n">gauge</span><span class="o">.</span><span class="nf">dec</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span> <span class="c1">// Decrement by given value</span>
<span class="n">gauge</span><span class="o">.</span><span class="nf">set</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="c1">// Set to a given value</span>
</code></pre>
<h2 id='histogram' class='heading'>Histogram</h2>

<p>Histograms track the size and number of events in buckets. This allows for aggregatable calculation of quantiles.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">histogram</span> <span class="o">=</span> <span class="n">myProm</span><span class="o">.</span><span class="nf">createHistogram</span><span class="p">(</span><span class="nv">forType</span><span class="p">:</span> <span class="kt">Double</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">named</span><span class="p">:</span> <span class="s">"my_histogram"</span><span class="p">)</span>
<span class="n">histogram</span><span class="o">.</span><span class="nf">observe</span><span class="p">(</span><span class="mf">4.7</span><span class="p">)</span> <span class="c1">// Observe the given value</span>
</code></pre>
<h2 id='summary' class='heading'>Summary</h2>

<p>Summaries track the size and number of events</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">summary</span> <span class="o">=</span> <span class="n">myProm</span><span class="o">.</span><span class="nf">createSummary</span><span class="p">(</span><span class="nv">forType</span><span class="p">:</span> <span class="kt">Double</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">named</span><span class="p">:</span> <span class="s">"my_summary"</span><span class="p">)</span>
<span class="n">summary</span><span class="o">.</span><span class="nf">observe</span><span class="p">(</span><span class="mf">4.7</span><span class="p">)</span> <span class="c1">// Observe the given value</span>
</code></pre>
<h2 id='labels' class='heading'>Labels</h2>

<p>All metric types support adding labels, allowing for grouping of related metrics.</p>

<p>Example with a counter:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">RouteLabels</span><span class="p">:</span> <span class="kt">MetricLabels</span> <span class="p">{</span>
   <span class="k">var</span> <span class="nv">route</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"*"</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">counter</span> <span class="o">=</span> <span class="n">myProm</span><span class="o">.</span><span class="nf">createCounter</span><span class="p">(</span><span class="nv">forType</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">named</span><span class="p">:</span> <span class="s">"my_counter"</span><span class="p">,</span> <span class="nv">helpText</span><span class="p">:</span> <span class="s">"Just a counter"</span><span class="p">,</span> <span class="nv">withLabelType</span><span class="p">:</span> <span class="kt">RouteLabels</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">counter</span> <span class="o">=</span> <span class="n">prom</span><span class="o">.</span><span class="nf">createCounter</span><span class="p">(</span><span class="nv">forType</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">named</span><span class="p">:</span> <span class="s">"my_counter"</span><span class="p">,</span> <span class="nv">helpText</span><span class="p">:</span> <span class="s">"Just a counter"</span><span class="p">,</span> <span class="nv">withLabelType</span><span class="p">:</span> <span class="kt">RouteLabels</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>

<span class="n">counter</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">route</span><span class="p">:</span> <span class="s">"/"</span><span class="p">))</span>
</code></pre>
<h1 id='exporting' class='heading'>Exporting</h1>

<p>Prometheus itself is designed to &ldquo;pull&rdquo; metrics from a destination. Following this pattern, SwiftPrometheus is designed to expose metrics, as opposed to submitted/exporting them directly to Prometheus itself. SwiftPrometheus produces a formatted string that Prometheus can parse, which can be integrated into your own application.</p>

<p>By default, this should be accessible on your main serving port, at the <code>/metrics</code> endpoint. An example in <a href="https://vapor.codes">Vapor</a>  4 syntax looks like:</p>
<pre class="highlight swift"><code><span class="n">app</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"metrics"</span><span class="p">)</span> <span class="p">{</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="kt">EventLoopFuture</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">promise</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">eventLoop</span><span class="o">.</span><span class="nf">makePromise</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">()</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="kt">MetricsSystem</span><span class="o">.</span><span class="nf">prometheus</span><span class="p">()</span><span class="o">.</span><span class="nf">collect</span><span class="p">(</span><span class="nv">into</span><span class="p">:</span> <span class="n">promise</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="n">promise</span><span class="o">.</span><span class="nf">fail</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">promise</span><span class="o">.</span><span class="n">futureResult</span>
<span class="p">}</span>
</code></pre>
<h1 id='contributing' class='heading'>Contributing</h1>

<p>All contributions are most welcome!</p>

<p>If you think of some cool new feature that should be included, please <a href="https://github.com/MrLotU/SwiftPrometheus/issues/new/choose">create an issue</a>. Or, if you want to implement it yourself, <a href="https://github.com/MrLotU/SwiftPrometheus/fork">fork this repo</a> and submit a PR!</p>

<p>If you find a bug or have issues, please <a href="https://github.com/MrLotU/SwiftPrometheus/issues/new/choose">create an issue</a> explaining your problems. Please include as much information as possible, so it&rsquo;s easier for me to reproduce (Framework, OS, Swift version, terminal output, etc.)</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2021 <a class="link" href="https://github.com/MrLotU" target="_blank" rel="external">MrLotU</a>. All rights reserved. (Last updated: 2021-04-30)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
